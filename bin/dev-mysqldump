#!/bin/bash

set -eu

DIR="$(dirname -- "${0}")/.."

OUT="${DIR}/backups/data.$(date +%Y-%m-%d_%H%M%S_%z).sql"

(cd "${DIR}" && docker-compose exec db bash -c '
    mysqldump --defaults-file=<(echo "
    [client]
    host = localhost
    user = ${MYSQL_USER}
    password = ${MYSQL_PASSWORD}
    ") "${MYSQL_DATABASE}"
') > "${OUT}"
echo "Wrote ${OUT}."
